{% extends "base/base.html" %}

{% load staticfiles %}

{% block page_title %}
<title>Detalle: {{ participante.nombre }} {{ participante.apellido }}</title>
{% endblock page_title %}

{% block content %}
<section class="content-header">
	<h1>
		<a href="#" class="editable" data-name="nombre" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
			{{ participante.nombre }}
		</a>
		<a href="#" class="editable" data-name="apellido" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
			{{ participante.apellido }}
		</a>
	</h1>
</section>
<section class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-6">
				<div class="box box-success">
					<div class="box-header">
						<h3 class="box-title">Información</h3>
					</div>
					<div class="box-body">
						<dl class="dl-horizontal">
							{% csrf_token %}
							<dt>DPI</dt>
							<dd>
								<a href="#" class="editable" data-name="dpi" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.dpi }}
								</a>
							</dd>

							<dt>Rol</dt>
							<dd>
								<a href="#" class="editable" data-name="rol" data-type="select" data-source="[{% for rol in rol_list %}{'{{ rol.id }}': '{{ rol.nombre }}'},{% endfor %}]" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.rol }}
								</a>
							</dd>

							<dt>Género</dt>
							<dd>
								<a href="#" class="editable" data-name="genero" data-type="select" data-source="[{% for genero in genero_list %}{'{{ genero.id }}': '{{ genero.genero }}'},{% endfor %}]" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.genero|default_if_none:"" }}
								</a>
							</dd>

							<dt>Escuela</dt>
							<dd><a href="{{ participante.escuela.get_absolute_url }}" class="label label-info">{{ participante.escuela.nombre }} ({{ participante.escuela.codigo }})</a></dd>

							<dt>Dirección</dt>
							<dd>
								<a href="#" class="editable" data-name="direccion" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.direccion|default_if_none:"" }}
								</a>
							</dd>

							<dt>Correo electrónico</dt>
							<dd>
								<a href="#" class="editable" data-name="mail" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.mail|default_if_none:"" }}
								</a>
							</dd>

							<dt>Teléfono</dt>
							<dd>
								<a href="#" class="editable" data-name="tel_movil" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.tel_movil|default_if_none:"" }}
								</a>
							</dd>

							<dt>Fecha de nacimiento</dt>
							<dd>
								<a href="#" class="editable" data-name="fecha_nac" data-type="text" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.fecha_nac|date:"Y-m-d"|default_if_none:"" }}
								</a>
							</dd>

							<dt>Etnia</dt>
							<dd>
								<a href="#" class="editable" data-name="etnia" data-type="select" data-source="[{% for etnia in etnia_list %}{'{{ etnia.id }}': '{{ etnia.nombre }}'},{% endfor %}]" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.etnia|default_if_none:"" }}
								</a>
							</dd>

							<dt>Escolaridad</dt>
							<dd>
								<a href="#" class="editable" data-name="escolaridad" data-type="select" data-source="[{% for escolaridad in escolaridad_list %}{'{{ escolaridad.id }}': '{{ escolaridad.nombre }}'},{% endfor %}]" data-pk="{{ participante.id }}" data-url="{% url 'participante_api_update' pk=participante.id %}">
									{{ participante.escolaridad|default_if_none:"" }}
								</a>
							</dd>
						</dl>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="box box-solid">
					<div class="box-header">
						<h3 class="box-title">Capacitaciones</h3>
					</div>
					<div class="box-body no-padding">
						<div class="box-group" id="accordion">
							{% for asignacion in participante.asignaciones.all|dictsort:"grupo.sede.id" %}
								<div class="panel box box-primary">
									<div class="box-header with-border">
										<div class="box-title">
											<a data-toggle="collapse" data-parent="#accordion" href="#collapse-{{ asignacion.id }}" class="" aria-expanded="true">
												{{ asignacion.grupo.curso }}
											</a>
										</div>
										<div class="box-tools">
											<a href="{{ asignacion.grupo.get_absolute_url }}" class="btn btn-box-tool"><i class="fa fa-external-link"></i></a>
										</div>
									</div>
									<div id="collapse-{{ asignacion.id }}" class="panel-collapse collapse" aria-expanded="false">
										<div class="box-body no-padding table-responsive">
											<div class="user-block">
												<span class="username">
													<div class="row-fluid">
														<div class="col-sm-4 col-xs-12">
															<a href="{{ asignacion.grupo.sede.get_absolute_url }}">{{ asignacion.grupo.sede }}</a>
														</div>
														<div class="col-sm-4 col-xs-12">
													 		<a href="{{ asignacion.grupo.get_absolute_url}}">Grupo {{ asignacion.grupo.numero }}</a>
														</div>
														<div class="col-sm-4 col-xs-12">
													  		Asignación: {{ asignacion.id }}
														</div>
													</div>
												</span>
												<span class="description">{{ asignacion.grupo.sede.capacitador.get_full_name }}</span>
											</div>
											<table class="table table-striped table-bordered table-condensed">
												<tr>
													<th colspan="3">Asistencias</th>
												</tr>
												{% for nota in asignacion.notas_asistencias.all %}												
													<tr>
														<td align="center"> {{ forloop.counter }}</td>
														<td align="center">
															{{ nota.gr_calendario.fecha|date:"Y-m-d"|default_if_none:"No asignado" }} <br>
															{{ nota.gr_calendario.hora_inicio|default_if_none:"" }} - {{ nota.gr_calendario.hora_fin|default_if_none:"" }}
														</td>
														<td align="center">
															<a href="#" class="editable badge bg-blue" data-name="nota" data-type="text" data-pk="{{ nota.id }}" data-url="{% url 'nota_asistencia_api_update' pk=nota.id %}">
																{{ nota.nota }}
															</a>
														</td>
													</tr>
												{% endfor %}
												<tr>
													<th colspan="3">Hitos</th>
												</tr>
												{% for nota in asignacion.notas_hitos.all %}
													<tr>
														<td align="center">{{ forloop.counter }}</td>
														<!--<td align="center">{{ nota.cr_hito.id }}</td> -->
														<td align="center">{{ nota.cr_hito.nombre }}</td>
														<td align="center">
															<a href="#" class="editable badge bg-blue" data-name="nota" data-type="text" data-pk="{{ nota.id }}" data-url="{% url 'nota_hito_api_update' pk=nota.id %}">
																{{ nota.nota }}
															</a>
														</td>
													</tr>
												{% endfor %}
												<tr>
													<th>Nota final</th>
													<td align="center">
														{% if asignacion.get_nota_final >= asignacion.grupo.curso.nota_aprobacion %}
															<span class="label label-success">Aprobado</span>
														{% else %}
															<span class="label label-danger">Reprobado</span>
														{% endif %}
													</td>
													<td align="center">
														{% if asignacion.get_nota_final >= asignacion.grupo.curso.nota_aprobacion %}
															<span class="badge bg-green">{{ asignacion.get_nota_final }}</span>
														{% else %}
															<span class="badge bg-red">{{ asignacion.get_nota_final }}</span>
														{% endif %}
													</td>
												</tr>
											</table>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
{% endblock content %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap-editable.css' %}">
{% endblock extra_css %}

{% block extra_js %}
<script src="{% static 'js/bootstrap-editable.min.js' %}"></script>
<script src="{% static "js/extrajs/cyd.js" %}"></script>
<script>

	ParticipanteDetail.init();
</script>
{% endblock extra_js %}
